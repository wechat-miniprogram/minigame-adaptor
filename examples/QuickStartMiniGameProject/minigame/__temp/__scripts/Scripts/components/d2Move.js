"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var engine_1 = require("engine");
var eventCenter_js_1 = require("../commons/eventCenter.js");
var SCREEN_WIDTH = engine_1.default.device.screenWidth;
var SCREEN_HEIGHT = engine_1.default.device.screenHeight;
var GAME_WIDTH = engine_1.default.adaptation.frameWidth;
var GAME_HEIGHT = engine_1.default.adaptation.frameHeight;
var D2Move = (function (_super) {
    tslib_1.__extends(D2Move, _super);
    function D2Move(entity) {
        var _this = _super.call(this, entity) || this;
        _this.entity = entity;
        _this.buttonPos = engine_1.default.Vector2.ZERO.clone();
        _this.buttonRadius = { x: 0, y: 0 };
        _this.direction = engine_1.default.Vector2.ZERO.clone();
        _this.uisprite = null;
        _this.uiInput = null;
        _this.onTouchStart = _this.onTouchStart.bind(_this);
        _this.onTouchEnter = _this.onTouchEnter.bind(_this);
        _this.onTouchMove = _this.onTouchMove.bind(_this);
        _this.onTouchEnd = _this.onTouchEnd.bind(_this);
        _this.onTouchLeave = _this.onTouchLeave.bind(_this);
        return _this;
    }
    D2Move.prototype.onAwake = function () {
        this.uisprite = this.entity.getComponent(engine_1.default.UISprite);
        this.buttonPos = this.entity.transform2D.worldPosition.clone();
        this.buttonRadius = { x: this.entity.transform2D.size.x / 2, y: this.entity.transform2D.size.y / 2 };
    };
    D2Move.prototype.onEnable = function () {
        this.uiInput = this.getComponent(engine_1.default.TouchInputComponent);
        if (this.uiInput) {
            this.uiInput.onTouchStart.add(this.onTouchStart);
            this.uiInput.onTouchEnter.add(this.onTouchEnter);
            this.uiInput.onTouchEnd.add(this.onTouchEnd);
            this.uiInput.onTouchLeave.add(this.onTouchLeave);
            this.uiInput.onTouchMove.add(this.onTouchMove);
        }
    };
    D2Move.prototype.onDisable = function () {
        if (this.uiInput) {
            this.uiInput.onTouchStart.remove(this.onTouchStart);
            this.uiInput.onTouchEnter.remove(this.onTouchEnter);
            this.uiInput.onTouchEnd.remove(this.onTouchEnd);
            this.uiInput.onTouchLeave.remove(this.onTouchLeave);
            this.uiInput.onTouchMove.remove(this.onTouchMove);
        }
    };
    D2Move.prototype.onTouchStart = function (s, e) {
        this.setAlpha(200);
        this.handleTouch(e);
    };
    D2Move.prototype.onTouchEnter = function (s, e) {
        this.setAlpha(200);
        this.handleTouch(e);
    };
    D2Move.prototype.onTouchMove = function (s, e) {
        this.handleTouch(e);
    };
    D2Move.prototype.onTouchLeave = function (s, e) {
        this.setAlpha(255);
        this.emitDirection({ x: 0, y: 0, z: 0 });
    };
    D2Move.prototype.onTouchEnd = function (s, e) {
        this.setAlpha(255);
        this.emitDirection({ x: 0, y: 0, z: 0 });
    };
    D2Move.prototype.handleTouch = function (e) {
        this.direction.x = e.touches[0].position.x / this.buttonRadius.x;
        this.direction.y = e.touches[0].position.y / this.buttonRadius.y;
        this.emitDirection({ x: this.direction.x, y: 0, z: -this.direction.y });
    };
    D2Move.prototype.setAlpha = function (val) {
        var c = this.uisprite.color.clone();
        c.a = val;
        this.uisprite.color = c;
    };
    D2Move.prototype.emitDirection = function (direction) {
        eventCenter_js_1.default.emit(eventCenter_js_1.default.TOUCH_MOVE, direction);
    };
    D2Move.prototype.gamePosToScreen = function (pos) {
        var p = engine_1.default.Vector2.ZERO.clone();
        p.x = SCREEN_WIDTH / GAME_WIDTH * pos.x;
        p.y = SCREEN_HEIGHT / GAME_HEIGHT * pos.y;
        return p;
    };
    D2Move.prototype.canvasPosToScreen = function (pos) {
        pos.x = pos.x - SCREEN_WIDTH / 2;
        pos.y = -pos.y + SCREEN_HEIGHT / 2;
        return pos;
    };
    D2Move = tslib_1.__decorate([
        engine_1.default.decorators.serialize("D2Move")
    ], D2Move);
    return D2Move;
}(engine_1.default.Script));
exports.default = D2Move;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlNjcmlwdHMvY29tcG9uZW50cy9kMk1vdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQ0EsaUNBQTRCO0FBSTVCLDREQUFvRDtBQUVwRCxJQUFNLFlBQVksR0FBRyxnQkFBTSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUM7QUFDL0MsSUFBTSxhQUFhLEdBQUcsZ0JBQU0sQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDO0FBQ2pELElBQU0sVUFBVSxHQUFHLGdCQUFNLENBQUMsVUFBVSxDQUFDLFVBQVUsQ0FBQztBQUNoRCxJQUFNLFdBQVcsR0FBRyxnQkFBTSxDQUFDLFVBQVUsQ0FBQyxXQUFXLENBQUM7QUFHbEQ7SUFBb0Msa0NBQWE7SUFPL0MsZ0JBQTRCLE1BQWdCO1FBQTVDLFlBQ0Usa0JBQU0sTUFBTSxDQUFDLFNBTWQ7UUFQMkIsWUFBTSxHQUFOLE1BQU0sQ0FBVTtRQU5yQyxlQUFTLEdBQUcsZ0JBQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ3hDLGtCQUFZLEdBQUcsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQztRQUM5QixlQUFTLEdBQUcsZ0JBQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ3hDLGNBQVEsR0FBRyxJQUFJLENBQUM7UUFDaEIsYUFBTyxHQUFzQyxJQUFJLENBQUM7UUFJdkQsS0FBSSxDQUFDLFlBQVksR0FBRyxLQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxLQUFJLENBQUMsQ0FBQztRQUNqRCxLQUFJLENBQUMsWUFBWSxHQUFHLEtBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLEtBQUksQ0FBQyxDQUFDO1FBQ2pELEtBQUksQ0FBQyxXQUFXLEdBQUcsS0FBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsS0FBSSxDQUFDLENBQUM7UUFDL0MsS0FBSSxDQUFDLFVBQVUsR0FBRyxLQUFJLENB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VixJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUM7SUFDMUIsQ0FBQztJQUVNLDhCQUFhLEdBQXBCLFVBQXFCLFNBQStDO1FBQ2xFLHdCQUFXLENBQUMsSUFBSSxDQUFDLHdCQUFXLENBQUMsVUFBVSxFQUFFLFNBQVMsQ0FBQyxDQUFDO0lBQ3RELENBQUM7SUFFTSxnQ0FBZSxHQUF0QixVQUF1QixHQUFZO1FBQ2pDLElBQU0sQ0FBQyxHQUFHLGdCQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUN0QyxDQUFDLENBQUMsQ0FBQyxHQUFHLFlBQVksR0FBRyxVQUFVLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUN4QyxDQUFDLENBQUMsQ0FBQyxHQUFHLGFBQWEsR0FBRyxXQUFXLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUMxQyxPQUFPLENBQUMsQ0FBQztJQUNYLENBQUM7SUFFTSxrQ0FBaUIsR0FBeEIsVUFBeUIsR0FBRztRQUUxQixHQUFHLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLEdBQUcsWUFBWSxHQUFHLENBQUMsQ0FBQztRQUNqQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxhQUFhLEdBQUcsQ0FBQyxDQUFDO1FBQ25DLE9BQU8sR0FBRyxDQUFDO0lBQ2IsQ0FBQztJQS9Ga0IsTUFBTTtRQUQxQixnQkFBTSxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDO09BQ2pCLE1BQU0sQ0FnRzFCO0lBQUQsYUFBQztDQWhHRCxBQWdHQyxDQWhHbUMsZ0JBQU0sQ0FBQyxNQUFNLEdBZ0doRDtrQkFoR29CLE1BQU0iLCJmaWxlIjoiU2NyaXB0cy9jb21wb25lbnRzL2QyTW92ZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIGltcG9ydCBlbmdpbmUgZnJvbSAnZW5naW5lJztcbmltcG9ydCBlbmdpbmUgZnJvbSBcImVuZ2luZVwiO1xuZGVjbGFyZSB0eXBlIFZlY3RvcjIgPSBpbXBvcnQoXCJlbmdpbmUvZW5naW5lXCIpLlZlY3RvcjI7XG5kZWNsYXJlIHR5cGUgVG91Y2hJbnB1dEV2ZW50ID0gaW1wb3J0KFwiZW5naW5lL2lucHV0L3RvdWNoXCIpLlRvdWNoSW5wdXRFdmVudDtcbmRlY2xhcmUgdHlwZSBFbnRpdHkyRCA9IGltcG9ydChcImVuZ2luZS9zY2VuZS9zY2VuZVwiKS5FbnRpdHkyRDtcbmltcG9ydCBFdmVudENlbnRlciBmcm9tIFwiLi4vY29tbW9ucy9ldmVudENlbnRlci5qc1wiO1xuXG5jb25zdCBTQ1JFRU5fV0lEVEggPSBlbmdpbmUuZGV2aWNlLnNjcmVlbldpZHRoO1xuY29uc3QgU0NSRUVOX0hFSUdIVCA9IGVuZ2luZS5kZXZpY2Uuc2NyZWVuSGVpZ2h0O1xuY29uc3QgR0FNRV9XSURUSCA9IGVuZ2luZS5hZGFwdGF0aW9uLmZyYW1lV2lkdGg7XG5jb25zdCBHQU1FX0hFSUdIVCA9IGVuZ2luZS5hZGFwdGF0aW9uLmZyYW1lSGVpZ2h0O1xuXG5AZW5naW5lLmRlY29yYXRvcnMuc2VyaWFsaXplKFwiRDJNb3ZlXCIpXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBEMk1vdmUgZXh0ZW5kcyBlbmdpbmUuU2NyaXB0IHtcbiAgcHVibGljIGJ1dHRvblBvcyA9IGVuZ2luZS5WZWN0b3IyLlpFUk8uY2xvbmUoKTsgLy8g5oyJ6ZKu55qEY2FudmFz5Z2Q5qCHXG4gIHB1YmxpYyBidXR0b25SYWRpdXMgPSB7IHg6IDAsIHk6IDAgfTtcbiAgcHVibGljIGRpcmVjdGlvbiA9IGVuZ2luZS5WZWN0b3IyLlpFUk8uY2xvbmUoKTtcbiAgcHVibGljIHVpc3ByaXRlID0gbnVsbDtcbiAgcHVibGljIHVpSW5wdXQ6IGVuZ2luZS5Ub3VjaElucHV0Q29tcG9uZW50IHwgbnVsbCA9IG51bGw7XG5cbiAgY29uc3RydWN0b3IocHVibGljIHJlYWRvbmx5IGVudGl0eTogRW50aXR5MkQpIHtcbiAgICBzdXBlcihlbnRpdHkpO1xuICAgIHRoaXMub25Ub3VjaFN0YXJ0ID0gdGhpcy5vblRvdWNoU3RhcnQuYmluZCh0aGlzKTtcbiAgICB0aGlzLm9uVG91Y2hFbnRlciA9IHRoaXMub25Ub3VjaEVudGVyLmJpbmQodGhpcyk7XG4gICAgdGhpcy5vblRvdWNoTW92ZSA9IHRoaXMub25Ub3VjaE1vdmUuYmluZCh0aGlzKTtcbiAgICB0aGlzLm9uVG91Y2hFbmQgPSB0aGlzLm9uVG91Y2hFbmQuYmluZCh0aGlzKTtcbiAgICB0aGlzLm9uVG91Y2hMZWF2ZSA9IHRoaXMub25Ub3VjaExlYXZlLmJpbmQodGhpcyk7XG4gIH1cblxuICBwdWJsaWMgb25Bd2FrZSgpIHtcbiAgICB0aGlzLnVpc3ByaXRlID0gdGhpcy5lbnRpdHkuZ2V0Q29tcG9uZW50KGVuZ2luZS5VSVNwcml0ZSk7XG4gICAgdGhpcy5idXR0b25Qb3MgPSB0aGlzLmVudGl0eS50cmFuc2Zvcm0yRC53b3JsZFBvc2l0aW9uLmNsb25lKCk7XG4gICAgdGhpcy5idXR0b25SYWRpdXMgPSB7IHg6IHRoaXMuZW50aXR5LnRyYW5zZm9ybTJELnNpemUueCAvIDIsIHk6IHRoaXMuZW50aXR5LnRyYW5zZm9ybTJELnNpemUueSAvIDIgfTtcbiAgfVxuXG4gIHB1YmxpYyBvbkVuYWJsZSgpOiB2b2lkIHtcbiAgICB0aGlzLnVpSW5wdXQgPSB0aGlzLmdldENvbXBvbmVudDxlbmdpbmUuVG91Y2hJbnB1dENvbXBvbmVudD4oZW5naW5lLlRvdWNoSW5wdXRDb21wb25lbnQpO1xuICAgIGlmICh0aGlzLnVpSW5wdXQpIHtcbiAgICAgIHRoaXMudWlJbnB1dC5vblRvdWNoU3RhcnQuYWRkKHRoaXMub25Ub3VjaFN0YXJ0KTtcbiAgICAgIHRoaXMudWlJbnB1dC5vblRvdWNoRW50ZXIuYWRkKHRoaXMub25Ub3VjaEVudGVyKTtcbiAgICAgIHRoaXMudWlJbnB1dC5vblRvdWNoRW5kLmFkZCh0aGlzLm9uVG91Y2hFbmQpO1xuICAgICAgdGhpcy51aUlucHV0Lm9uVG91Y2hMZWF2ZS5hZGQodGhpcy5vblRvdWNoTGVhdmUpO1xuICAgICAgdGhpcy51aUlucHV0Lm9uVG91Y2hNb3ZlLmFkZCh0aGlzLm9uVG91Y2hNb3ZlKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgb25EaXNhYmxlKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLnVpSW5wdXQpIHtcbiAgICAgIHRoaXMudWlJbnB1dC5vblRvdWNoU3RhcnQucmVtb3ZlKHRoaXMub25Ub3VjaFN0YXJ0KTtcbiAgICAgIHRoaXMudWlJbnB1dC5vblRvdWNoRW50ZXIucmVtb3ZlKHRoaXMub25Ub3VjaEVudGVyKTtcbiAgICAgIHRoaXMudWlJbnB1dC5vblRvdWNoRW5kLnJlbW92ZSh0aGlzLm9uVG91Y2hFbmQpO1xuICAgICAgdGhpcy51aUlucHV0Lm9uVG91Y2hMZWF2ZS5yZW1vdmUodGhpcy5vblRvdWNoTGVhdmUpO1xuICAgICAgdGhpcy51aUlucHV0Lm9uVG91Y2hNb3ZlLnJlbW92ZSh0aGlzLm9uVG91Y2hNb3ZlKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgb25Ub3VjaFN0YXJ0KHM6IGVuZ2luZS5Ub3VjaElucHV0Q29tcG9uZW50LCBlOiBUb3VjaElucHV0RXZlbnQpIHtcbiAgICB0aGlzLnNldEFscGhhKDIwMCk7XG4gICAgdGhpcy5oYW5kbGVUb3VjaChlKTtcbiAgfVxuXG4gIHB1YmxpYyBvblRvdWNoRW50ZXIoczogZW5naW5lLlRvdWNoSW5wdXRDb21wb25lbnQsIGU6IFRvdWNoSW5wdXRFdmVudCkge1xuICAgIHRoaXMuc2V0QWxwaGEoMjAwKTtcbiAgICB0aGlzLmhhbmRsZVRvdWNoKGUpO1xuICB9XG5cbiAgcHVibGljIG9uVG91Y2hNb3ZlKHM6IGVuZ2luZS5Ub3VjaElucHV0Q29tcG9uZW50LCBlOiBUb3VjaElucHV0RXZlbnQpIHtcbiAgICB0aGlzLmhhbmRsZVRvdWNoKGUpO1xuICB9XG5cbiAgcHVibGljIG9uVG91Y2hMZWF2ZShzOiBlbmdpbmUuVG91Y2hJbnB1dENvbXBvbmVudCwgZTogVG91Y2hJbnB1dEV2ZW50KSB7XG4gICAgdGhpcy5zZXRBbHBoYSgyNTUpO1xuICAgIHRoaXMuZW1pdERpcmVjdGlvbih7IHg6IDAsIHk6IDAsIHo6IDAgfSk7XG4gIH1cblxuICBwdWJsaWMgb25Ub3VjaEVuZChzOiBlbmdpbmUuVG91Y2hJbnB1dENvbXBvbmVudCwgZTogVG91Y2hJbnB1dEV2ZW50KSB7XG4gICAgdGhpcy5zZXRBbHBoYSgyNTUpO1xuICAgIHRoaXMuZW1pdERpcmVjdGlvbih7IHg6IDAsIHk6IDAsIHo6IDAgfSk7XG4gIH1cblxuICBwdWJsaWMgaGFuZGxlVG91Y2goZTogVG91Y2hJbnB1dEV2ZW50KSB7XG4gICAgdGhpcy5kaXJlY3Rpb24ueCA9IGUudG91Y2hlc1swXS5wb3NpdGlvbi54IC8gdGhpcy5idXR0b25SYWRpdXMueDtcbiAgICB0aGlzLmRpcmVjdGlvbi55ID0gZS50b3VjaGVzWzBdLnBvc2l0aW9uLnkgLyB0aGlzLmJ1dHRvblJhZGl1cy55O1xuICAgIHRoaXMuZW1pdERpcmVjdGlvbih7IHg6IHRoaXMuZGlyZWN0aW9uLngsIHk6IDAsIHo6IC10aGlzLmRpcmVjdGlvbi55IH0pO1xuICB9XG5cbiAgcHVibGljIHNldEFscGhhKHZhbDogbnVtYmVyKTogdm9pZCB7XG4gICAgY29uc3QgYyA9IHRoaXMudWlzcHJpdGUuY29sb3IuY2xvbmUoKTtcbiAgICBjLmEgPSB2YWw7XG4gICAgdGhpcy51aXNwcml0ZS5jb2xvciA9IGM7XG4gIH1cblxuICBwdWJsaWMgZW1pdERpcmVjdGlvbihkaXJlY3Rpb246IHsgeDogbnVtYmVyOyB5OiBudW1iZXI7IHo6IG51bWJlcjsgfSk6IHZvaWQge1xuICAgIEV2ZW50Q2VudGVyLmVtaXQoRXZlbnRDZW50ZXIuVE9VQ0hfTU9WRSwgZGlyZWN0aW9uKTtcbiAgfVxuXG4gIHB1YmxpYyBnYW1lUG9zVG9TY3JlZW4ocG9zOiBWZWN0b3IyKTogVmVjdG9yMiB7XG4gICAgY29uc3QgcCA9IGVuZ2luZS5WZWN0b3IyLlpFUk8uY2xvbmUoKTtcbiAgICBwLnggPSBTQ1JFRU5fV0lEVEggLyBHQU1FX1dJRFRIICogcG9zLng7XG4gICAgcC55ID0gU0NSRUVOX0hFSUdIVCAvIEdBTUVfSEVJR0hUICogcG9zLnk7XG4gICAgcmV0dXJuIHA7XG4gIH1cblxuICBwdWJsaWMgY2FudmFzUG9zVG9TY3JlZW4ocG9zKSB7XG4gICAgLy8gY29uc29sZS5sb2cocG9zKTtcbiAgICBwb3MueCA9IHBvcy54IC0gU0NSRUVOX1dJRFRIIC8gMjtcbiAgICBwb3MueSA9IC1wb3MueSArIFNDUkVFTl9IRUlHSFQgLyAyO1xuICAgIHJldHVybiBwb3M7XG4gIH1cbn1cbiJdfQ==
